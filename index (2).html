<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EstudiandoAndo | Simulador Infinito</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', 'sans-serif'],
                    },
                    colors: {
                        ios: {
                            bg: '#F5F5F7',
                            surface: '#FFFFFF',
                            text: '#1D1D1F',
                            subtext: '#86868B',
                            blue: '#0066CC',
                            blueHover: '#004499',
                            border: '#D2D2D7',
                            divider: '#E5E5EA'
                        }
                    },
                    boxShadow: {
                        'soft': '0 4px 12px rgba(0,0,0,0.03)',
                        'floating': '0 12px 24px rgba(0,0,0,0.06)'
                    }
                }
            }
        }
    </script>

    <style>
        body {
            -webkit-font-smoothing: antialiased;
            background-color: #FFFFFF; /* Landing is white, exam uses grey bg */
            color: #1D1D1F;
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .option-card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .option-card:hover {
            border-color: #0066CC;
            background-color: #FAFAFA;
        }
        .option-selected {
            background-color: #F0F8FF !important;
            border-color: #0066CC !important;
            box-shadow: 0 0 0 1px #0066CC inset;
        }
        .option-selected .option-radio {
            background-color: #0066CC;
            border-color: #0066CC;
            box-shadow: inset 0 0 0 3px white;
        }

        @media (min-width: 1024px) {
            .exam-layout {
                height: calc(100vh - 64px);
                overflow: hidden;
            }
            .scroll-pane {
                height: 100%;
                overflow-y: auto;
                scrollbar-width: thin;
                scrollbar-color: #D2D2D7 transparent;
            }
        }

        .btn-ios {
            border-radius: 980px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-ios:active { transform: scale(0.98); opacity: 0.9; }

        .animate-fade-in {
            animation: fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }
        
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
    </style>
</head>
<body class="h-screen flex flex-col">

    <!-- Navbar -->
    <nav class="glass-nav fixed w-full z-50 h-16 flex items-center justify-between px-6 lg:px-12">
        <div class="flex items-center gap-4 cursor-pointer" onclick="location.reload()">
            <span class="text-xl font-semibold tracking-tight text-ios-text">EstudiandoAndo</span>
            <span class="hidden md:inline-block h-4 w-[1px] bg-ios-border"></span>
            <span class="hidden md:inline-block text-sm text-ios-subtext flex items-center gap-1">
                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9v-2h2v2zm0-4H9V7h2v5z"/></svg>
                Modo Aleatorio
            </span>
        </div>
        
        <div id="exam-controls" class="hidden flex items-center gap-6">
            <div class="flex flex-col items-end">
                <span id="timer-display" class="font-mono text-sm font-medium tabular-nums text-ios-text">00:00</span>
                <span id="progress-text" class="text-[10px] text-ios-subtext uppercase tracking-wider font-semibold">Iniciando...</span>
            </div>
            <button onclick="app.finishExam()" class="text-sm font-medium text-ios-blue hover:text-ios-blueHover transition-colors">
                Finalizar
            </button>
        </div>
    </nav>

    <div class="h-16 w-full shrink-0"></div>

    <main id="main-container" class="flex-1 w-full relative overflow-y-auto">

        <!-- VIEW 1: NEW LANDING PAGE -->
        <div id="view-landing" class="min-h-full flex flex-col items-center justify-center p-6 bg-white">
            
            <div class="max-w-5xl w-full mx-auto py-12 lg:py-20">
                
                <!-- Hero Section -->
                <div class="text-center max-w-3xl mx-auto mb-20 animate-fade-in">
                    <span class="inline-block px-4 py-1.5 rounded-full bg-blue-50 text-ios-blue text-xs font-bold uppercase tracking-wide mb-6 border border-blue-100">
                        Simulador Infinito EXANI-II
                    </span>
                    <h1 class="text-5xl md:text-7xl font-semibold tracking-tight text-ios-text mb-6">
                        Practica sin l√≠mites.<br>
                        <span class="text-gray-300">Nunca repitas el mismo examen.</span>
                    </h1>
                    <p class="text-xl text-ios-subtext leading-relaxed font-light">
                        Nuestro motor inteligente genera una combinaci√≥n √∫nica de textos y preguntas cada vez que inicias sesi√≥n, para que te enfoques en razonar, no en memorizar.
                    </p>
                </div>

                <!-- Features Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-20 animate-fade-in delay-100">
                    
                    <!-- Card 1: Structure -->
                    <div class="bg-ios-bg p-8 md:p-10 rounded-[32px] border border-ios-border relative overflow-hidden group hover:border-blue-200 transition-colors">
                        <div class="absolute top-0 right-0 p-8 opacity-5 group-hover:opacity-10 transition-opacity transform group-hover:scale-110 duration-500">
                            <svg class="w-32 h-32" fill="currentColor" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                        </div>
                        <div class="w-14 h-14 bg-white rounded-2xl flex items-center justify-center text-3xl shadow-sm mb-6">üìö</div>
                        <h3 class="text-2xl font-bold text-ios-text mb-3">Estructura Real</h3>
                        <p class="text-ios-subtext mb-6 leading-relaxed">
                            Simulamos fielmente el formato del Ceneval. En cada sesi√≥n enfrentar√°s una mezcla equilibrada de:
                        </p>
                        <ul class="space-y-3">
                            <li class="flex items-center gap-3 text-sm font-medium text-gray-600">
                                <span class="w-2 h-2 rounded-full bg-blue-500"></span>Textos Argumentativos y Period√≠sticos
                            </li>
                            <li class="flex items-center gap-3 text-sm font-medium text-gray-600">
                                <span class="w-2 h-2 rounded-full bg-purple-500"></span>Textos Narrativos y Literarios
                            </li>
                            <li class="flex items-center gap-3 text-sm font-medium text-gray-600">
                                <span class="w-2 h-2 rounded-full bg-green-500"></span>Textos Cient√≠ficos y Expositivos
                            </li>
                        </ul>
                    </div>

                    <!-- Card 2: Random Engine -->
                    <div class="bg-ios-bg p-8 md:p-10 rounded-[32px] border border-ios-border relative overflow-hidden group hover:border-blue-200 transition-colors">
                        <div class="absolute top-0 right-0 p-8 opacity-5 group-hover:opacity-10 transition-opacity transform group-hover:rotate-12 duration-500">
                            <svg class="w-32 h-32" fill="currentColor" viewBox="0 0 24 24"><path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/></svg>
                        </div>
                        <div class="w-14 h-14 bg-white rounded-2xl flex items-center justify-center text-3xl shadow-sm mb-6">üîÄ</div>
                        <h3 class="text-2xl font-bold text-ios-text mb-3">Motor Aleatorio</h3>
                        <p class="text-ios-subtext mb-6 leading-relaxed">
                            Nuestro algoritmo selecciona preguntas de un banco masivo y las baraja al instante. <strong>Ning√∫n intento es igual al anterior.</strong>
                        </p>
                        <div class="flex items-center justify-between bg-white rounded-2xl p-4 border border-ios-divider">
                            <div class="text-center">
                                <div class="text-lg font-bold text-ios-text">12+</div>
                                <div class="text-[10px] text-ios-subtext font-bold uppercase tracking-wider">Textos Base</div>
                            </div>
                            <div class="h-8 w-px bg-gray-200"></div>
                            <div class="text-center">
                                <div class="text-lg font-bold text-ios-text">50+</div>
                                <div class="text-[10px] text-ios-subtext font-bold uppercase tracking-wider">Reactivos</div>
                            </div>
                            <div class="h-8 w-px bg-gray-200"></div>
                            <div class="text-center">
                                <div class="text-lg font-bold text-ios-text">‚àû</div>
                                <div class="text-[10px] text-ios-subtext font-bold uppercase tracking-wider">Sesiones</div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- CTA -->
                <div class="text-center animate-fade-in delay-200">
                    <button onclick="app.start()" class="group relative inline-flex items-center justify-center px-12 py-5 text-lg font-medium text-white transition-all duration-200 bg-ios-text rounded-full hover:bg-black hover:shadow-xl hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-900">
                        <span class="mr-3">Generar Sesi√≥n Nueva</span>
                        <svg class="w-5 h-5 group-hover:rotate-180 transition-transform duration-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    </button>
                    <p class="mt-4 text-xs font-medium text-gray-400 uppercase tracking-wide">
                        Algoritmo v2.0 ‚Ä¢ Base de datos actualizada
                    </p>
                </div>

            </div>
        </div>

        <!-- VIEW 2: EXAM INTERFACE (Kept logic intact) -->
        <div id="view-exam" class="hidden h-full flex-col lg:flex-row exam-layout bg-white lg:bg-ios-bg">
            
            <!-- Left Pane: Text -->
            <div id="reading-pane" class="lg:w-1/2 h-full bg-ios-bg border-r border-ios-border scroll-pane">
                <div class="p-8 lg:p-12 max-w-2xl mx-auto">
                    <div class="flex items-center justify-between mb-6">
                        <span id="reading-tag" class="inline-block px-3 py-1 rounded-full bg-white border border-ios-border text-[10px] font-bold tracking-wide text-ios-subtext uppercase shadow-sm">TEMA</span>
                    </div>
                    <h2 id="reading-title" class="text-3xl font-bold text-ios-text mb-8 leading-tight">...</h2>
                    <div id="reading-content" class="prose prose-lg text-ios-text leading-loose font-normal text-justify"></div>
                </div>
            </div>

            <!-- Right Pane: Questions -->
            <div class="lg:w-1/2 h-full bg-white scroll-pane relative">
                <div class="p-8 lg:p-12 max-w-xl mx-auto flex flex-col min-h-full justify-center">
                    
                    <div id="question-container" class="opacity-0 transition-opacity duration-300">
                        <span id="q-counter" class="text-ios-blue font-bold text-xs uppercase tracking-wide mb-3 block">Pregunta 1</span>
                        <h3 id="question-text" class="text-2xl font-medium text-ios-text mb-8 leading-snug">...</h3>

                        <div id="options-list" class="space-y-3"></div>
                    </div>

                    <div class="mt-12 pt-8 border-t border-ios-divider flex justify-between items-center">
                        <button onclick="app.prev()" id="btn-prev" class="text-ios-subtext hover:text-ios-text font-medium text-sm px-4 py-2 disabled:opacity-30 transition-colors" disabled>
                            Anterior
                        </button>
                        <button onclick="app.next()" id="btn-next" class="btn-ios bg-ios-blue text-white hover:bg-ios-blueHover px-8 py-3 text-sm shadow-lg shadow-blue-500/20">
                            Siguiente
                        </button>
                    </div>

                </div>
            </div>
        </div>

        <!-- VIEW 3: RESULTS -->
        <div id="view-results" class="hidden h-full overflow-y-auto bg-ios-bg p-6 lg:p-12">
            <div class="max-w-4xl mx-auto animate-fade-in">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-semibold text-ios-text tracking-tight mb-2">Informe de Sesi√≥n</h2>
                    <p class="text-ios-subtext text-lg">Resultados del examen generado aleatoriamente.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                    <div class="bg-white p-8 rounded-3xl shadow-soft text-center border border-ios-border">
                        <div class="text-xs font-bold text-ios-subtext uppercase tracking-wide mb-2">Aciertos</div>
                        <div id="score-val" class="text-5xl font-bold text-ios-text">0</div>
                    </div>
                    <div class="bg-white p-8 rounded-3xl shadow-soft text-center border border-ios-border">
                        <div class="text-xs font-bold text-ios-subtext uppercase tracking-wide mb-2">Precisi√≥n</div>
                        <div id="percent-val" class="text-5xl font-bold text-ios-blue">0%</div>
                    </div>
                    <div class="bg-white p-8 rounded-3xl shadow-soft text-center border border-ios-border">
                        <div class="text-xs font-bold text-ios-subtext uppercase tracking-wide mb-2">Tiempo</div>
                        <div id="time-val" class="text-5xl font-bold text-gray-400">00:00</div>
                    </div>
                </div>

                <div class="bg-white p-8 rounded-3xl shadow-soft mb-12 border border-ios-border">
                    <h3 class="text-lg font-semibold text-ios-text mb-6">Desglose por Tipo de Texto</h3>
                    <div class="h-64 w-full">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <div class="flex justify-center gap-4">
                    <button onclick="location.reload()" class="bg-ios-text text-white hover:bg-black btn-ios px-8 py-3 font-medium text-lg shadow-lg">
                        Volver al Inicio
                    </button>
                </div>
            </div>
        </div>

    </main>

    <!-- LOGIC -->
    <script>
        // --- REPOSITORIO DE TEXTOS (POOL) ---
        // 12 Textos Base.
        const TEXT_POOL = [
            {
                id: "t_ia", title: "El Dilema de la Inteligencia Artificial", type: "Argumentativo",
                content: `<p>La irrupci√≥n de la IA generativa ha desatado un debate √©tico. Por un lado, los tecnoptimistas celebran la automatizaci√≥n; por otro, los cr√≠ticos advierten sobre el sesgo. No obstante, el peligro reside en la falta de regulaci√≥n. Si delegamos el pensamiento cr√≠tico, atrofiamos nuestro juicio.</p>`,
                questions: [
                    { q: "¬øTesis central?", opts: ["Prohibir la IA.", "El riesgo es la falta de regulaci√≥n.", "La IA es perfecta.", "El arte IA es mejor."], ans: 1 },
                    { q: "¬øQu√© implica 'atrofiar el juicio'?", opts: ["Ser m√°s listo.", "Debilitar la capacidad de decidir.", "Ser m√°s r√°pido.", "Programar mejor."], ans: 1 },
                    { q: "Intenci√≥n comunicativa:", opts: ["Narrar.", "Describir.", "Persuadir.", "Poetizar."], ans: 2 }
                ]
            },
            {
                id: "t_espejos", title: "La Casa de los Espejos", type: "Narrativo",
                content: `<p>Juli√°n entr√≥ en la feria. Una carta an√≥nima lo citaba all√≠. Al entrar a la sala de espejos, su reflejo dej√≥ de imitarlo. El reflejo sonri√≥ y se√±al√≥ la salida justo antes de que se apagaran las luces.</p>`,
                questions: [
                    { q: "¬øPor qu√© fue Juli√°n?", opts: ["A pasear.", "Por una carta an√≥nima.", "A trabajar.", "Se perdi√≥."], ans: 1 },
                    { q: "¬øQu√© hizo el reflejo?", opts: ["Gritar.", "Se√±alar la salida.", "Romperse.", "Nada."], ans: 1 },
                    { q: "Elemento de tensi√≥n:", opts: ["Luces apagadas.", "Autonom√≠a del reflejo.", "Ruido.", "Calor."], ans: 1 }
                ]
            },
            {
                id: "t_fotosintesis", title: "Fotos√≠ntesis Artificial", type: "Cient√≠fico",
                content: `<p>Buscamos replicar c√≥mo las plantas convierten luz en energ√≠a. A diferencia de paneles solares, esto produce combustible l√≠quido. El reto es el costo de los catalizadores como el platino.</p>`,
                questions: [
                    { q: "Objetivo principal:", opts: ["Crear plantas.", "Combustible limpio.", "Paneles solares.", "Miner√≠a."], ans: 1 },
                    { q: "Obst√°culo actual:", opts: ["Falta de sol.", "Costo de catalizadores.", "Peligro.", "Espacio."], ans: 1 },
                    { q: "Diferencia con fotovoltaica:", opts: ["Genera l√≠quido/gas.", "Genera electricidad.", "Es m√°s barata.", "Usa viento."], ans: 0 }
                ]
            },
            {
                id: "t_microplasticos", title: "Micropl√°sticos", type: "Expositivo",
                content: `<p>Part√≠culas menores a 5mm. Entran en la cadena alimenticia v√≠a plancton. Esto causa bioacumulaci√≥n hasta llegar al ser humano. Se estiman 50 billones en el mar.</p>`,
                questions: [
                    { q: "Definici√≥n:", opts: ["T√≥xico.", "Menor a 5mm.", "Azul.", "Flotante."], ans: 1 },
                    { q: "¬øQu√© es bioacumulaci√≥n?", opts: ["Limpieza.", "Concentraci√≥n progresiva de toxinas.", "Reproducci√≥n.", "Reciclaje."], ans: 1 },
                    { q: "Fuente:", opts: ["Petr√≥leo.", "Cosm√©ticos/Residuos.", "Lluvia.", "Barcos."], ans: 1 }
                ]
            },
            {
                id: "t_borges", title: "El Tiempo (Poema)", type: "Literario",
                content: `<p>El tiempo es un r√≠o que me arrebata, pero yo soy el r√≠o; es un tigre que me destroza, pero yo soy el tigre. El mundo, desgraciadamente, es real; yo, desgraciadamente, soy Borges.</p>`,
                questions: [
                    { q: "Figura ret√≥rica en 'El tiempo es un r√≠o':", opts: ["Met√°fora.", "S√≠mil.", "Hip√©rbole.", "An√°fora."], ans: 0 },
                    { q: "Sentimiento de 'desgraciadamente':", opts: ["Alegr√≠a.", "Resignaci√≥n.", "Ira.", "Indiferencia."], ans: 1 },
                    { q: "El tigre representa:", opts: ["Naturaleza.", "Destrucci√≥n.", "Belleza.", "Velocidad."], ans: 1 }
                ]
            },
            {
                id: "t_logica", title: "Silogismos", type: "L√≥gico",
                content: `<p>P1: Todos los metales conducen electricidad. P2: El oro es un metal. C: El oro conduce electricidad.</p>`,
                questions: [
                    { q: "Tipo de razonamiento:", opts: ["Deductivo.", "Inductivo.", "Anal√≥gico.", "Falaz."], ans: 0 },
                    { q: "Si P1 fuera falsa:", opts: ["La conclusi√≥n es falsa.", "El razonamiento pierde validez material.", "Nada.", "P2 es falsa."], ans: 1 },
                    { q: "T√©rmino medio:", opts: ["Conductor.", "Metal.", "Oro.", "Electricidad."], ans: 1 }
                ]
            },
            {
                id: "t_cons", title: "La Ca√≠da de Constantinopla", type: "Hist√≥rico",
                content: `<p>En 1453, los otomanos tomaron la ciudad. Este evento marc√≥ el fin de la Edad Media. La migraci√≥n de sabios griegos a Italia impuls√≥ el Renacimiento.</p>`,
                questions: [
                    { q: "¬øQu√© marc√≥ este evento?", opts: ["Fin de Edad Media.", "Inicio de Roma.", "Fin del Renacimiento.", "Inicio de Cruzadas."], ans: 0 },
                    { q: "Consecuencia cultural:", opts: ["Guerra.", "Impulso al Renacimiento.", "Peste negra.", "Ca√≠da del Islam."], ans: 1 },
                    { q: "A√±o del suceso:", opts: ["1492.", "1453.", "1066.", "1810."], ans: 1 }
                ]
            },
            {
                id: "t_remote", title: "Trabajo Remoto vs. Oficina", type: "Argumentativo",
                content: `<p>El trabajo remoto ofrece flexibilidad, pero erosiona la cultura corporativa. La falta de interacci√≥n espont√°nea limita la innovaci√≥n. Sin embargo, obligar al retorno total es un error; el modelo h√≠brido es el √∫nico camino sostenible.</p>`,
                questions: [
                    { q: "Tesis del autor:", opts: ["Todos a la oficina.", "Todos a casa.", "El modelo h√≠brido es la soluci√≥n.", "La cultura no importa."], ans: 2 },
                    { q: "Desventaja del remoto:", opts: ["Tr√°fico.", "Erosi√≥n de cultura e innovaci√≥n.", "Gasto de luz.", "Comodidad."], ans: 1 },
                    { q: "Conector 'Sin embargo':", opts: ["Contraste.", "Suma.", "Causa.", "Tiempo."], ans: 0 }
                ]
            },
            {
                id: "t_quijote", title: "Fragmento: Don Quijote", type: "Literario",
                content: `<p>En un lugar de la Mancha, de cuyo nombre no quiero acordarme... Viv√≠a un hidalgo de los de lanza en astillero. Se enfrasc√≥ tanto en la lectura que se le sec√≥ el cerebro.</p>`,
                questions: [
                    { q: "Causa de la locura:", opts: ["Golpe.", "Leer mucho.", "Hambre.", "Amor."], ans: 1 },
                    { q: "Narrador:", opts: ["Omnisciente.", "Protagonista.", "Testigo.", "Segunda persona."], ans: 0 },
                    { q: "Tono inicial:", opts: ["Solemne.", "Misterioso/Ir√≥nico.", "Tr√°gico.", "Period√≠stico."], ans: 1 }
                ]
            },
            {
                id: "t_crispr", title: "Edici√≥n Gen√©tica CRISPR", type: "Cient√≠fico",
                content: `<p>CRISPR permite 'cortar y pegar' ADN. Podr√≠a curar enfermedades hereditarias. El riesgo √©tico son los 'beb√©s de dise√±o', donde se eligen rasgos est√©ticos, creando desigualdad biol√≥gica.</p>`,
                questions: [
                    { q: "Beneficio potencial:", opts: ["Beb√©s guapos.", "Curar enfermedades hereditarias.", "Clonar.", "Hacer dinosaurios."], ans: 1 },
                    { q: "Riesgo √©tico:", opts: ["Desigualdad biol√≥gica.", "Costo bajo.", "Dolor.", "Falta de m√©dicos."], ans: 0 },
                    { q: "Funci√≥n de CRISPR:", opts: ["Radiograf√≠a.", "Edici√≥n de ADN.", "Vacuna.", "Antibi√≥tico."], ans: 1 }
                ]
            },
            {
                id: "t_admin", title: "Circular Administrativa", type: "Administrativo",
                content: `<p>Se informa que el estacionamiento cerrar√° por mantenimiento del 1 al 3 de mayo. Usen el anexo B. Disculpen las molestias.</p>`,
                questions: [
                    { q: "Prop√≥sito:", opts: ["Despedir.", "Informar cierre temporal.", "Cobrar.", "Celebrar."], ans: 1 },
                    { q: "Alternativa ofrecida:", opts: ["Calle.", "Anexo B.", "No venir.", "Pagar m√°s."], ans: 1 },
                    { q: "Duraci√≥n:", opts: ["1 mes.", "3 d√≠as.", "1 semana.", "Indefinido."], ans: 1 }
                ]
            },
            {
                id: "t_abejas", title: "El Colapso de las Abejas", type: "Expositivo",
                content: `<p>Las abejas polinizan el 70% de los cultivos. Su poblaci√≥n cae por pesticidas y cambio clim√°tico. Sin ellas, la seguridad alimentaria mundial colapsar√≠a.</p>`,
                questions: [
                    { q: "Importancia:", opts: ["Hacen miel.", "Polinizan cultivos.", "Son bonitas.", "Pican."], ans: 1 },
                    { q: "Causas del declive:", opts: ["Pesticidas/Clima.", "P√°jaros.", "Mala suerte.", "Invierno."], ans: 0 },
                    { q: "Consecuencia:", opts: ["Menos flores.", "Colapso alimentario.", "M√°s moscas.", "Nada."], ans: 1 }
                ]
            }
        ];

        // --- MOTOR ALEATORIO (RANDOM ENGINE) ---
        const app = {
            sessionQuestions: [],
            currentQIndex: 0,
            answers: [],
            timer: 0,
            interval: null,

            // Fisher-Yates Shuffle Algorithm
            shuffle: function(array) {
                let currentIndex = array.length, randomIndex;
                while (currentIndex != 0) {
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;
                    [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
                }
                return array;
            },

            // Generar examen nuevo
            initSession: function() {
                // 1. Barajar todos los textos disponibles
                const shuffledTexts = this.shuffle([...TEXT_POOL]);
                
                // 2. Seleccionar los primeros 6 (por ejemplo)
                const selectedTexts = shuffledTexts.slice(0, 6);
                
                // 3. Aplanar las preguntas de esos textos seleccionados
                this.sessionQuestions = [];
                let qGlobalCounter = 0;

                selectedTexts.forEach(text => {
                    text.questions.forEach(q => {
                        this.sessionQuestions.push({
                            ...q,
                            textTitle: text.title,
                            textContent: text.content,
                            textType: text.type,
                            id: qGlobalCounter++
                        });
                    });
                });

                // Inicializar respuestas
                this.answers = new Array(this.sessionQuestions.length).fill(null);
            },

            start: function() {
                this.initSession();
                
                // UI Switch
                document.getElementById('view-landing').classList.add('hidden');
                document.getElementById('view-exam').classList.remove('hidden');
                document.getElementById('view-exam').classList.add('flex');
                document.getElementById('exam-controls').classList.remove('hidden');
                document.getElementById('exam-controls').classList.add('flex');
                
                this.loadQuestion(0);
                this.startTimer();
            },

            loadQuestion: function(idx) {
                if(idx < 0 || idx >= this.sessionQuestions.length) return;
                this.currentQIndex = idx;
                const q = this.sessionQuestions[idx];
                const total = this.sessionQuestions.length;

                // Update Reading Pane (Only if text changes)
                const currentTitle = document.getElementById('reading-title').innerText;
                if (currentTitle !== q.textTitle) {
                    document.getElementById('reading-title').innerText = q.textTitle;
                    document.getElementById('reading-tag').innerText = q.textType.toUpperCase();
                    document.getElementById('reading-content').innerHTML = q.textContent;
                    document.getElementById('reading-pane').scrollTop = 0;
                }

                // Update Question (with Fade effect)
                const qContainer = document.getElementById('question-container');
                qContainer.classList.remove('opacity-100');
                qContainer.classList.add('opacity-0');

                setTimeout(() => {
                    document.getElementById('q-counter').innerText = `PREGUNTA ${idx + 1} DE ${total}`;
                    document.getElementById('question-text').innerText = q.q;

                    // Options
                    const optsList = document.getElementById('options-list');
                    optsList.innerHTML = '';
                    q.opts.forEach((opt, i) => {
                        const btn = document.createElement('div');
                        const isSelected = this.answers[idx] === i;
                        btn.className = `option-card w-full p-4 border rounded-xl cursor-pointer flex items-center gap-4 bg-white border-ios-border ${isSelected ? 'option-selected' : ''}`;
                        btn.onclick = () => { this.answers[idx] = i; this.loadQuestion(idx); };
                        btn.innerHTML = `
                            <div class="option-radio w-5 h-5 rounded-full border border-ios-subtext shrink-0 bg-white transition-colors"></div>
                            <span class="text-ios-text text-sm font-medium leading-relaxed">${opt}</span>
                        `;
                        optsList.appendChild(btn);
                    });

                    qContainer.classList.remove('opacity-0');
                    qContainer.classList.add('opacity-100');
                }, 150);

                // Progress Update
                document.getElementById('progress-text').innerText = `${idx + 1} / ${total} REACTIVOS`;

                // Buttons
                document.getElementById('btn-prev').disabled = idx === 0;
                const next = document.getElementById('btn-next');
                if(idx === total - 1) {
                    next.innerText = "Revisar Examen";
                    next.onclick = () => this.finishExam();
                } else {
                    next.innerText = "Siguiente";
                    next.onclick = () => this.next();
                }
            },

            next: function() { this.loadQuestion(this.currentQIndex + 1); },
            prev: function() { this.loadQuestion(this.currentQIndex - 1); },

            startTimer: function() {
                this.timer = 0;
                if(this.interval) clearInterval(this.interval);
                this.interval = setInterval(() => {
                    this.timer++;
                    const m = Math.floor(this.timer / 60);
                    const s = this.timer % 60;
                    document.getElementById('timer-display').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                }, 1000);
            },

            finishExam: function() {
                clearInterval(this.interval);
                document.getElementById('view-exam').classList.add('hidden');
                document.getElementById('view-exam').classList.remove('flex');
                document.getElementById('exam-controls').classList.add('hidden');
                document.getElementById('view-results').classList.remove('hidden');

                let correct = 0;
                let byType = {};

                this.sessionQuestions.forEach((q, i) => {
                    const isCorrect = this.answers[i] === q.ans;
                    if(isCorrect) correct++;
                    
                    if(!byType[q.textType]) byType[q.textType] = {total:0, ok:0};
                    byType[q.textType].total++;
                    if(isCorrect) byType[q.textType].ok++;
                });

                // Stats
                document.getElementById('score-val').innerText = correct;
                document.getElementById('percent-val').innerText = Math.round((correct/this.sessionQuestions.length)*100) + "%";
                const m = Math.floor(this.timer/60);
                const s = this.timer%60;
                document.getElementById('time-val').innerText = `${m}:${s.toString().padStart(2,'0')}`;

                // Chart
                const labels = Object.keys(byType);
                const data = labels.map(l => (byType[l].ok / byType[l].total) * 100);
                
                // Clean Chart if exists
                const chartStatus = Chart.getChart("categoryChart"); 
                if (chartStatus != undefined) chartStatus.destroy();

                new Chart(document.getElementById('categoryChart'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Precisi√≥n (%)',
                            data: data,
                            backgroundColor: '#1D1D1F',
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { y: { beginAtZero: true, max: 100 } },
                        plugins: { legend: { display: false } }
                    }
                });
            }
        };

    </script>
</body>
</html>